{"changed":true,"filter":false,"title":"template.yaml","tooltip":"/template.yaml","value":"AWSTemplateFormatVersion: '2010-09-09'\nTransform: AWS::Serverless-2016-10-31\n\nParameters:\n  dbUsername:\n    Description: Name of superuser of database\n    Type: String\n  RoleID:\n    Description: Name of superuser of database\n    Type: String\n  apikeyWeatherbit:\n    NoEcho: true\n    Description: Apikey Weatherbit\n    Type: String\n  apikeyAirly:\n    NoEcho: true\n    Description: Apikey Airly\n    Type: String\n  apikeyICM:\n    NoEcho: true\n    Description: Apikey ICM\n    Type: String\n  dbPassword:\n    NoEcho: true\n    Description: Podaj haslo dla !Ref dbUsernamea bazy danych\n    Type: String\n  EnvironmentName:\n    Description: Rodzaj środowiska\n    Type: String\n    AllowedValues: [DEV, PROD]\n    Default: DEV\n    ConstraintDescription: Musi być DEV lub PROD\n\nResources:\n  PrognozaPodlewaniaDB:\n    Type: 'AWS::RDS::DBInstance'\n    Properties:\n      DBInstanceIdentifier: db-test\n      DBName: DBPrognozaPodlewania\n      DBInstanceClass: db.t2.micro\n      AllocatedStorage: 20 \n      Engine: MySQL\n      EngineVersion: 8.0.16\n      MasterUsername: !Ref dbUsername\n      MasterUserPassword: !Ref dbPassword\n      MonitoringInterval: '60'\n      MonitoringRoleArn: 'arn:aws:iam::790651879093:role/rds-monitoring-role'\n      \n\n  prognozapogodypobierzDaneWeatherbitDoPrognozy:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.8\n      CodeUri: functions/prognoza-podlewania-pobierzDaneWeatherbitDoPrognozy.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 3\n      Role: 'arn:aws:iam::790651879093:role/LambdaFullAccess'\n      Environment:\n        Variables:\n          db_name: DBPrognozaPodlewania\n          db_username: !Ref dbUsername\n          password: !Ref dbPassword\n          rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n  prognozapodlewaniaczyPrognozaPrawidlowa:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.8\n      CodeUri: functions/prognoza-podlewania-czyPrognozaPrawidlowa.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 3\n      Role: 'arn:aws:iam::790651879093:role/LambdaFullAccess'\n      Environment:\n        Variables:\n          db_name: DBPrognozaPodlewania\n          db_username: !Ref dbUsername\n          password: !Ref dbPassword\n          rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n  prognozapodlewaniaczyTemperatura:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-czyTemperatura.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 3\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          jednostka: C\n          max: '30'\n          min: '10'\n          rodzajTemp: naturalna\n  prognozapodlewaniadynamoDBTOMySQL:\n      Type: 'AWS::Serverless::Function'\n      Properties:\n        Handler: lambda_function.lambda_handler\n        Runtime: python3.6\n        CodeUri: functions/prognoza-podlewania-dynamoDBTOMySQL.zip\n        Description: ''\n        MemorySize: 128\n        Timeout: 16\n        Role: !Ref RoleID\n        Environment:\n          Variables:\n            DYNAMODB_NAME: prognoza-podlewaniaDB\n            db_name: DBPrognozaPodlewania\n            db_username: !Ref dbUsername\n            password: !Ref dbPassword\n            rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n  prognozapodlewaniaobslugaDatyCzasu:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-obslugaDatyCzasu.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 6\n      Role: !Ref RoleID\n\n  prognozapodlewaniapobierzICMdoPrognozy:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-pobierzICMdoPrognozy.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 6\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          db_name: DBPrognozaPodlewania\n          db_table: pognozaICM\n          db_username: !Ref dbUsername\n          password: !Ref dbPassword\n          rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n  prognozapodlewaniaPOSTMySQL:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-POST-MySQL.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 8\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          db_endpoint: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n          db_name: DBPrognozaPodlewania\n          db_username: !Ref dbUsername\n          password: !Ref dbPassword\n          rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n  prognozapodlewaniatlumaczenieNaPL:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-tlumaczenieNaPL.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 6\n      Role: !Ref RoleID\n  prognozapodlewaniazapisDoBazy:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-zapisDoBazy.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 8\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          DB_NAME: DBPrognozaPodlewania\n  prognozapogodyczyWilgotnosc:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-czyWilgotnosc.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 8\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          max: '60'\n          min: '0'\n          minZachmurzenie: '40'\n          opt: '45'\n  prognozapogodypobierzArlyDoPrognozy:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-pobierzArlyDoPrognozy.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 8\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          db_name: DBPrognozaPodlewania\n          db_username: !Ref dbUsername\n          password: !Ref dbPassword\n          rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n  prognozapodlewaniaobslugaDatyCzasu:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.6\n      CodeUri: functions/prognoza-podlewania-obslugaDatyCzasu.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 8\n      Role: !Ref RoleID\n  prognozapodlewaniaUPDATEMySQL:\n    Type: 'AWS::Serverless::Function'\n    Properties:\n      Handler: lambda_function.lambda_handler\n      Runtime: python3.8\n      CodeUri: functions/prognoza-podlewania-UPDATE-MySQL.zip\n      Description: ''\n      MemorySize: 128\n      Timeout: 6\n      Role: !Ref RoleID\n      Environment:\n        Variables:\n          password: !Ref dbPassword\n          db_name: DBPrognozaPodlewania\n          db_username: !Ref dbUsername\n          rds_host: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n          field_update: 'cZP_temp_odcz, cZP_temp'\n  maszynaStanowaZapiszDoBazy:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: Prognoza-podlewania-zapisDoBaz\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |-\n        {\n          \"Comment\": \"A Hello World example of the Amazon States Language using Pass states\",\n          \"StartAt\": \"Hello\",\n          \"States\": {\n            \"Hello\": {\n              \"Type\": \"Pass\",\n              \"Next\": \"ObslugaDatyCzasu\"\n            },\n            \"ObslugaDatyCzasu\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniaobslugaDatyCzasu.Arn}\",\n              \"Next\": \"ZapisDoSQL\"\n            },\n            \"ZapisDoSQL\": {\n              \"Type\": \"Task\",\n              \"TimeoutSeconds\": 3,\n              \"HeartbeatSeconds\": 3,\n              \"Resource\": \"${prognozapodlewaniaPOSTMySQL.Arn}\",\n              \"Catch\": [\n                {\n                  \"ErrorEquals\": [\"Blad\"],\n                  \"Next\": \"Blad\"\n                }],\n              \"End\": true\n            },\n            \"Blad\":{\n              \"Type\": \"Fail\",\n              \"Cause\":\"Nie udalo sie zapisac do bazy!\",\n              \"Error\": \"Error\"\n            }\n          }\n        }\n      RoleArn: arn:aws:iam::790651879093:role/service-role/StepFunctions-MojaMaszynaStanowa-role-c3a6af5b\n  maszynaStanowaUpdateDoBazy:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: Prognoza-podlewania-updateDoBaz\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |-\n        {\n          \"Comment\": \"A Hello World example of the Amazon States Language using Pass states\",\n          \"StartAt\": \"CzyPrognozaPrawidlowa\",\n          \"States\": {\n            \"CzyPrognozaPrawidlowa\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniaczyPrognozaPrawidlowa.Arn}\",\n              \"Next\": \"UpdateDoSQL\"\n            },\n            \"UpdateDoSQL\": {\n              \"Type\": \"Task\",\n              \"TimeoutSeconds\": 10,\n              \"HeartbeatSeconds\": 10,\n              \"Resource\": \"${prognozapodlewaniaUPDATEMySQL.Arn}\",\n              \"Catch\": [ \n                {\n                  \"ErrorEquals\": [\"Blad\"],\n                  \"Next\": \"Blad\"\n                }],\n              \"End\": true\n            },\n            \"Blad\":{\n              \"Type\": \"Fail\",\n              \"Cause\":\"Nie udalo sie zapisac do bazy!\",\n              \"Error\": \"Error\"\n            }\n          }\n        }\n      RoleArn: arn:aws:iam::790651879093:role/service-role/StepFunctions-MojaMaszynaStanowa-role-c3a6af5b\n  maszynaStanowa:\n    Type: AWS::StepFunctions::StateMachine\n    Properties:\n      StateMachineName: Prognoza-podlewania-maszynaStanowa\n      StateMachineType: STANDARD\n      DefinitionString: !Sub |-\n        {\n          \"Comment\": \"Prognoza podlewania ma na celu sprawdzenie, czy nalezy podlewac kwiaty na balkonie\",\n          \"StartAt\": \"czyTemperatura\",\n          \"States\": {\n            \"czyTemperatura\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniaczyTemperatura.Arn}\",\n              \"Next\": \"czyWilgotnosc\"\n            },\n            \"czyWilgotnosc\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapogodyczyWilgotnosc.Arn}\",\n              \"Next\": \"ObsługaParametrow\"\n            },\n            \"ObsługaParametrow\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniaobslugaDatyCzasu.Arn}\",\n              \"Next\": \"pobierzZICM\"\n            },\n            \"pobierzZICM\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniapobierzICMdoPrognozy.Arn}\",\n              \"Next\": \"pobierzZAirly\"\n            },\n            \"pobierzZAirly\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapogodypobierzArlyDoPrognozy.Arn}\",\n              \"Next\": \"pobierzZWeatherbit\"\n            },\n            \"pobierzZWeatherbit\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapogodypobierzDaneWeatherbitDoPrognozy.Arn}\",\n              \"Next\": \"CzyPrognozaPrawidlowa\"\n            },\n            \"CzyPrognozaPrawidlowa\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniaczyPrognozaPrawidlowa.Arn}\",\n              \"Next\": \"tlumaczenieOpisu\"\n            },\n            \"tlumaczenieOpisu\": {\n              \"Type\": \"Task\",\n              \"Resource\": \"${prognozapodlewaniatlumaczenieNaPL.Arn}\",\n              \"Next\": \"Parallel\"\n            },\n            \"Parallel\": {\n              \"Type\": \"Parallel\",\n              \"End\": true,\n              \"Branches\": [\n                {\n                  \"StartAt\": \"ZapisDoBazyDynamoDB\",\n                  \"States\": {\n                    \"ZapisDoBazyDynamoDB\": {\n                      \"Type\": \"Task\",\n                      \"Resource\": \"${prognozapodlewaniazapisDoBazy.Arn}\",\n                      \"End\": true\n                    }\n                  }\n                },\n                {\n                  \"StartAt\": \"ZapisDoBazyMySQL\",\n                  \"States\": {\n                    \"ZapisDoBazyMySQL\": {\n                      \"Type\": \"Task\",\n                      \"TimeoutSeconds\": 3,\n                      \"HeartbeatSeconds\": 3,\n                      \"Resource\": \"${prognozapodlewaniaPOSTMySQL.Arn}\",\n                      \"Catch\": [\n                        {\n                          \"ErrorEquals\": [\"Blad\"],\n                          \"Next\": \"Blad\"\n                        }],\n                      \"End\": true\n                    },\n                    \"Blad\":{\n                      \"Type\": \"Fail\",\n                      \"Cause\":\"Nie udalo sie zapisac do bazy!\",\n                      \"Error\": \"Error\"\n                    }\n                  }\n                }\n              ]\n            }\n          }\n        }\n      RoleArn: arn:aws:iam::790651879093:role/service-role/StepFunctions-MojaMaszynaStanowa-role-c3a6af5b\n\nOutputs:\n  maszynaStanowaZapiszDoBazy:\n    Description: Zmienna ARN dla Step Function\n    Value:\n      Ref: maszynaStanowaZapiszDoBazy\n    Export:\n      Name: maszynaStanowaZapiszDoBazy\n  maszynaStanowaUpdateDoBazy:\n    Description: Zmienna ARN dla Step Function\n    Value:\n      Ref: maszynaStanowaUpdateDoBazy\n    Export:\n      Name: maszynaStanowaUpdateDoBazy\n  maszynaStanowa:\n    Description: Zmienna ARN dla Step Function\n    Value:\n      Ref: maszynaStanowa\n    Export:\n      Name: maszynaStanowa\n  rds:\n    Description: Zmienna rds_host z bazy danych\n    Value: !GetAtt PrognozaPodlewaniaDB.Endpoint.Address\n    Export:\n      Name: rdsHost\n","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":426,"column":8},"end":{"row":426,"column":9},"action":"remove","lines":["t"],"id":22},{"start":{"row":426,"column":7},"end":{"row":426,"column":8},"action":"remove","lines":["s"]},{"start":{"row":426,"column":6},"end":{"row":426,"column":7},"action":"remove","lines":["o"]},{"start":{"row":426,"column":5},"end":{"row":426,"column":6},"action":"remove","lines":["H"]}]]},"ace":{"folds":[],"scrolltop":5771,"scrollleft":0,"selection":{"start":{"row":420,"column":16},"end":{"row":420,"column":16},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":411,"state":"start","mode":"ace/mode/yaml"}},"timestamp":1583965648597}